<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Velion</title>
    <link rel="icon" href="logo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyCba6M_spBXvuG91Zn-XJ4bSTX6vNcST0",
            authDomain: "index-68220.firebaseapp.com",
            databaseURL: "https://index-68220-default-rtdb.firebaseio.com",
            projectId: "index-68220",
            storageBucket: "index-68220.firebasestorage.app",
            messagingSenderId: "633087068802",
            appId: "1:633087068802:web:f8aa1f2ef9c00b99d1429b",
            measurementId: "G-2VQCRFJQCM"
        };
        
        const SAFE_APP_ID = 'user-shortcuts'; 
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const shortcutRef = ref(db, 'artifacts/' + SAFE_APP_ID + '/shortcuts/list');

        let shortcutsData = {};
        
        const body = document.getElementById('body');
        const mainContentContainer = document.getElementById('mainContentContainer');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const edgeTrigger = document.getElementById('edge-trigger');
        const mainNavLinks = document.querySelectorAll('#main-nav a'); 
        const iframeContainer = document.getElementById('iframe-container');
        let appFrames = document.querySelectorAll('.app-frame'); 
        const staticFrames = document.querySelectorAll('#iframe-container > .app-frame:not([data-dynamic="true"])');

        let isInitialLoadDone = false; 
        const sidebarHeader = document.querySelector('.sidebar-header'); 
        const hamburgerButton = document.getElementById('hamburger-btn'); 
        
        const ACTIVE_KEY = 'activePageUrl'; 
        const DEFAULT_URL = 'https://zeroexec.github.io/01011001010100010100101000101101010101010111001010110101110110101101010110111111000101111100101/home'; 
        const SIDEBAR_OPEN_CLASS = 'sidebar-open';
        const SIDEBAR_LOCKED_CLASS = 'sidebar-locked'; 
        
        const isSmallScreen = () => window.matchMedia('(max-width: 992px)').matches;

        function openSidebar() {
            if (isSmallScreen() || (!body.classList.contains(SIDEBAR_LOCKED_CLASS) && !body.classList.contains(SIDEBAR_OPEN_CLASS))) {
                body.classList.add(SIDEBAR_OPEN_CLASS);
                mainContentContainer.style.pointerEvents = 'none'; 
            }
        }

        function closeSidebar() {
            if (body.classList.contains(SIDEBAR_OPEN_CLASS) && (!body.classList.contains(SIDEBAR_LOCKED_CLASS) || isSmallScreen())) {
                body.classList.remove(SIDEBAR_OPEN_CLASS);
                setTimeout(() => {
                    mainContentContainer.style.pointerEvents = 'auto';
                }, 350); 
            }
        }

        function toggleSidebarLock() {
            if (isSmallScreen()) return; 
            if (body.classList.contains(SIDEBAR_LOCKED_CLASS)) {
                body.classList.remove(SIDEBAR_LOCKED_CLASS);
                closeSidebar(); 
            } else {
                body.classList.add(SIDEBAR_LOCKED_CLASS);
                body.classList.add(SIDEBAR_OPEN_CLASS); 
                mainContentContainer.style.pointerEvents = 'auto'; 
            }
        }

        const setActiveState = (newUrl, element) => {
            document.querySelectorAll('#sidebar a').forEach(l => {
                l.classList.remove('active');
                l.removeAttribute('aria-current');
            });
            
            if (element) {
                element.classList.add('active');
                element.setAttribute('aria-current', 'page');
            }
            
            let targetFrame = document.querySelector(`.app-frame[data-url="${newUrl}"]`);

            if (targetFrame) {
                appFrames.forEach(frame => {
                    frame.classList.remove('active');
                });

                const frameNeedsLoad = targetFrame.src.endsWith('about:blank') || targetFrame.src.startsWith('about:blank');
                if (frameNeedsLoad) {
                    targetFrame.src = targetFrame.dataset.url;
                }
                targetFrame.classList.add('active');
            }
            
            if (!isInitialLoadDone) {
                staticFrames.forEach(frame => {
                    if (frame.src === 'about:blank' && frame.classList.contains('active')) {
                        frame.src = frame.dataset.url;
                    }
                });
                isInitialLoadDone = true; 
            }
            
            history.replaceState(null, '', newUrl);
            sessionStorage.setItem(ACTIVE_KEY, newUrl);
        };

        function startRealtimeListener() {
            onValue(shortcutRef, (snapshot) => {
                shortcutsData = snapshot.val() || {};
                renderShortcuts();
            }, (error) => {
                initializeActiveState();
            });
        }

        function renderShortcuts() {
            const grid = document.getElementById('app-grid-dynamic');
            grid.innerHTML = ''; 
            document.querySelectorAll('.app-frame[data-dynamic="true"]').forEach(f => f.remove());
            
            const keys = Object.keys(shortcutsData);
            const sortedKeys = keys.sort((a, b) => (shortcutsData[a].order || Infinity) - (shortcutsData[b].order || Infinity));

            if (sortedKeys.length > 0) {
                 const separator = document.createElement('div');
                 separator.className = 'separator-title';
                 separator.textContent = 'MORE TOOLS'; 
                 grid.appendChild(separator);
            }

            const fragment = document.createDocumentFragment();
            sortedKeys.forEach((key) => {
                const item = shortcutsData[key];
                const dynamicIframe = document.createElement('iframe');
                dynamicIframe.id = `dynamic-frame-${key}`; 
                dynamicIframe.className = 'app-frame';
                dynamicIframe.src = 'about:blank';
                dynamicIframe.dataset.url = item.url;
                dynamicIframe.dataset.dynamic = "true";
                dynamicIframe.title = item.name;
                iframeContainer.appendChild(dynamicIframe); 

                const appItem = document.createElement('a');
                appItem.href = '#'; 
                appItem.setAttribute('data-url', item.url);
                appItem.onclick = (e) => {
                    e.preventDefault();
                    setActiveState(item.url, appItem); 
                    if (!body.classList.contains(SIDEBAR_LOCKED_CLASS) || isSmallScreen()) closeSidebar();
                };
                appItem.className = 'dynamic-app-item';
                appItem.innerHTML = `<i class="fa-solid fa-cube"></i><span>${item.name}</span>`;
                fragment.appendChild(appItem);
            });
            grid.appendChild(fragment); 
            appFrames = document.querySelectorAll('.app-frame'); 
            initializeActiveState();
        }

        function initializeActiveState() {
            const savedUrl = sessionStorage.getItem(ACTIVE_KEY);
            let initialUrl = savedUrl || DEFAULT_URL;
            let initialLink = document.querySelector(`[data-url="${initialUrl}"]`) || document.querySelector(`[href="${initialUrl}"]`);
            
            if (!initialLink) {
                 initialLink = document.querySelector(`[href="${DEFAULT_URL}"]`);
                 initialUrl = DEFAULT_URL;
            }
            setActiveState(initialUrl, initialLink);
        }

        window.onload = () => {
             edgeTrigger.addEventListener('mouseenter', openSidebar);
             sidebarOverlay.addEventListener('click', closeSidebar);
             if (hamburgerButton) hamburgerButton.addEventListener('click', openSidebar);
             if (sidebarHeader) sidebarHeader.addEventListener('click', toggleSidebarLock); 
             
             mainNavLinks.forEach(link => {
                 link.addEventListener('click', e => {
                     e.preventDefault();
                     const newUrl = link.getAttribute('href'); 
                     setActiveState(newUrl, link); 
                     if (!body.classList.contains(SIDEBAR_LOCKED_CLASS) || isSmallScreen()) closeSidebar();
                 });
             });
             
             initializeActiveState();
             startRealtimeListener(); 

             window.addEventListener('resize', () => {
                 if (isSmallScreen() && body.classList.contains(SIDEBAR_LOCKED_CLASS)) body.classList.remove(SIDEBAR_LOCKED_CLASS);
             });
        };
    </script>
    
    <style>
        :root {
            --sidebar-width: 280px;
            --sidebar-border-width: 3px; 
            --touch-area: 12px;
            --primary-bg: #000000; 
            --secondary-bg: #0c0c0c; 
            --text-color: #f3f4f6;
            --main-transition-duration: 0.35s;
            --padding-x: 20px; 
            --shadow-color: rgba(0, 188, 212, 0.2); 
            --dynamic-item-bg: #1a1a1a;
            --dynamic-item-hover: #222222;
            --gradient-start: #3498db; 
            --gradient-middle: #00bcd4; 
            --gradient-end: #00acc1;   
        }

        body { margin: 0; font-family: 'Inter', sans-serif; background: #008B8B; height: 100vh; overflow: hidden; }
        #sidebar nav::-webkit-scrollbar { display: none; }
        #mobile-header { display: none; }

        #edge-trigger { position: fixed; left: 0; top: 0; height: 100vh; width: var(--touch-area); z-index: 3000; }
        #edge-trigger:hover::after { background: linear-gradient(to top, var(--gradient-start), var(--gradient-end)); width: 3px; }

        #sidebar {
            position: fixed; top: 0; left: 0; width: var(--sidebar-width); height: 100%;
            background-color: var(--primary-bg); color: var(--text-color); z-index: 2000;
            transform: translateX(calc(-1 * (var(--sidebar-width) + var(--sidebar-border-width))));
            transition: transform var(--main-transition-duration) cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border-right: var(--sidebar-border-width) solid; 
            border-image: linear-gradient(to bottom, var(--gradient-start), var(--gradient-end)) 1;
            display: flex; flex-direction: column;
        }

        .sidebar-header { padding: 30px var(--padding-x) 20px; border-bottom: 1px solid var(--secondary-bg); display: flex; align-items: center; gap: 15px; cursor: pointer; }
        .sidebar-header h1 { margin: 0; font-size: 1.5rem; background: linear-gradient(to bottom, var(--gradient-start), var(--gradient-end)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .profile-image { width: 40px; height: 40px; border-radius: 50%; }

        #sidebar nav { flex-grow: 1; display: flex; flex-direction: column; gap: 5px; padding: 0 var(--padding-x) 40px; overflow-y: scroll; scrollbar-width: none; }
        #sidebar a { color: var(--text-color); text-decoration: none; padding: 12px 15px; display: flex; align-items: center; gap: 15px; border-radius: 8px; transition: 0.2s; font-weight: 500; }
        #sidebar a:hover { background-color: var(--secondary-bg); transform: translateX(3px); }
        #sidebar a.active { background: linear-gradient(to right, var(--gradient-start), var(--gradient-end)); color: var(--primary-bg); font-weight: 700; }
        #sidebar a.active i { color: var(--primary-bg); }

        #mainContentContainer { width: 100%; height: 100%; position: relative; transition: var(--main-transition-duration); }
        .app-frame { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; background-color: var(--primary-bg); opacity: 0; z-index: 10; pointer-events: none; transition: opacity 0.3s; }
        .app-frame.active { opacity: 1; z-index: 11; pointer-events: auto; }
        
        .sidebar-open #sidebar { transform: translateX(0); }
        .sidebar-open #mainContentContainer { transform: translateX(calc(var(--sidebar-width) - 50px)); filter: brightness(0.6); }
        .sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1999; display: none; }
        .sidebar-open .sidebar-overlay { display: block; }
        
        .sidebar-locked #mainContentContainer { transform: translateX(var(--sidebar-width)); width: calc(100% - var(--sidebar-width)); padding: 20px; box-sizing: border-box; }
        .sidebar-locked .app-frame { border-radius: 12px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5); }
        .sidebar-locked #sidebar { transform: translateX(0); }

        @media (max-width: 992px) {
            #mobile-header { display: flex; position: fixed; top: 0; width: 100%; height: 60px; background: var(--primary-bg); z-index: 1500; align-items: center; justify-content: space-between; }
            #hamburger-btn { background: none; border: none; color: var(--gradient-start); font-size: 1.5rem; margin-left: var(--padding-x); }
            #mainContentContainer { margin-top: 60px; height: calc(100% - 60px); }
            .sidebar-locked #mainContentContainer { transform: translateX(0); width: 100%; padding: 0; }
        }
    </style>
</head>
<body id="body">
    <header id="mobile-header">
        <button id="hamburger-btn" class="menu-icon"><i class="fa-solid fa-bars"></i></button>
        <a href="#" class="profile-link"><img src="logo.png" class="profile-image"></a>
    </header>
    
    <div id="edge-trigger"></div>
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <div id="sidebar">
        <div class="sidebar-header">
            <img src="logo.png" class="profile-image">
            <div class="header-content"><h1>Velion</h1></div>
        </div>
        <nav>
            <div id="main-nav">
                <a href="https://zeroexec.github.io/01011001010100010100101000101101010101010111001010110101110110101101010110111111000101111100101/home" class="active">
                    <i class="fa-solid fa-house"></i><span>Home</span>
                </a>
                <a href="https://zeroexec.github.io/mytools/v-drive">
                    <i class="fa-solid fa-hard-drive"></i><span>V-Drive</span>
                </a>
                <a href="https://zeroexec.github.io/mytools/codingin">
                    <i class="fa-solid fa-terminal"></i><span>Terminal</span>
                </a>
            </div>
            <div id="app-grid-dynamic"></div>
        </nav>
    </div>

    <div id="mainContentContainer">
        <div id="iframe-container">
            <iframe id="home-frame" class="app-frame active" 
                src="https://zeroexec.github.io/01011001010100010100101000101101010101010111001010110101110110101101010110111111000101111100101/home" 
                data-url="https://zeroexec.github.io/01011001010100010100101000101101010101010111001010110101110110101101010110111111000101111100101/home">
            </iframe>
            <iframe id="vdrive-frame" class="app-frame" src="about:blank" data-url="https://zeroexec.github.io/mytools/v-drive"></iframe>
            <iframe id="terminal-frame" class="app-frame" src="about:blank" data-url="https://zeroexec.github.io/mytools/codingin"></iframe>
        </div>
    </div>
</body>
</html>
